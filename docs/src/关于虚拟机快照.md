#VMware #快照

### 快照的本质
</br>
VMware官方对快照的解释：

[knowledge.broadcom.com...](https://knowledge.broadcom.com/external/article/342618/overview-of-virtual-machine-snapshots-in.html)

快照是保存的虚拟机在某个特定时点的**数据**和**状态**。

- 状态包括电源状态（开机、关键、暂停）
    
- 数据包括了所有VM相关的数据，如虚拟磁盘及其内容，内存，其它设备如网卡等。
    

通常我们认为对VM创建快照是非常简单的事情，而且非常方便。但需留意如下情况：

- 快照常用于短期使用，比如在应用更改时创建一个快照作为还原点。
    
- **快照不是备份，也不应该被当作备份。** 它和VM的磁盘存放在同一存储路径下，不应该被长期保留（官方建议不要超过72小时，典型的场景建议不要超过一个周）。
    
- 创建快照后，原VM磁盘被锁定为只读状态，新的差异VMDK会被创建（命名类似于*
    
    -000001.vmdk），该VMDK会存放自创建快照以来的新变更。
    
- 删除快照时，对应的差异VMDK会被合并到原始VM磁盘，此时会产生一定的I/O，快照越大，合并的I/O操作越多，这也是为什么不能长期保留的原因。
    
- 快照数量，一条快照链最大支持32个快照。但为了生产环境的安全，我们不应该挑战这个极限。**一般仅推荐最多做2-3个，更多的快照不仅容易出问题，而且也会影响VM的性能。**根据VMware官方资料，性能最容易受快照影响的是GuestOS上运行的应用程序，如数据库等。
    

参考:

[knowledge.broadcom.com...](https://knowledge.broadcom.com/external/article/318825/best-practices-for-using-vmware-snapshot.html?utm_source=chatgpt.com)
</br>
### 备份与快照
</br>
虽然快照本身不是备份，但在备份VM过程中作用重大。有如下情况我们需要知道：

- 备份VM时，备份软件总是会先创建一个快照。然后对快照后的状态进行备份。
    
- 快照的类型有内存快照（包含内存中的内容），静默快照（文件系统一致性快照），和不包括前面两种类型的普通快照。想要更好地备份VM，我们有必要理解这些快照的区别。
    
- 备份结束后，我们应该确保备份软件创建的快照被自动删除。
    
- 在扩展RDM磁盘容量时建议不要有任何快照，可能会造成数据丢失。
    
- 不要取消正在执行中的快照删除和整合作业，这可能会损坏数据。